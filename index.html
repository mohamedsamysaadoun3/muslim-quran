<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>صانع فيديوهات القرآن الكريم</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Noto+Naskh+Arabic:wght@400;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Muslim Quran">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.6.0/tinycolor.min.js"></script>
</head>
<body class="dark-theme"> <!-- Default to dark theme -->

  <div id="app-container">
    <!-- Initial Screen -->
    <div id="initial-screen">
      <header class="app-header">
        <h1>صانع فيديوهات القرآن الكريم</h1>
        <button id="theme-toggle-initial" class="theme-button" title="تبديل الثيم">☀️</button>
      </header>
      <main>
        <div class="projects-section">
          <h2>مشاريعي المحفوظة</h2>
          <div id="projects-list">
            <p id="no-projects-message">لا توجد مشاريع محفوظة بعد.</p>
          </div>
        </div>
      </main>
      <footer class="initial-footer">
        <button id="go-to-editor-btn" class="button-primary-action"><i class="fas fa-plus"></i> إنشاء فيديو جديد</button>
        <p class="copyright">© 2025 Muslim Quran</p>
      </footer>
    </div>

    <!-- Editor Screen (New Structure) -->
    <div id="editor-screen" style="display:none;">
      <header id="editor-top-bar">
        <button id="editor-back-btn" class="top-bar-btn" title="العودة"><i class="fas fa-arrow-left"></i></button>
        <h2 id="editor-context-title">القرآن</h2>
        <button id="editor-save-btn" class="top-bar-btn primary">حفظ</button>
      </header>

      <main id="editor-preview-area">
        <div id="video-preview-container">
          <canvas id="video-preview-canvas"></canvas>
          <div id="preview-overlay-content">
            <h2 id="preview-surah-title"></h2>
            <div id="preview-ayah-text" class="arabic-text"></div>
            <div id="preview-translation-text" class="translation-text-overlay"></div>
          </div>
          <audio id="ayah-audio-player" style="display:none;"></audio>
        </div>
      </main>

      <div id="editor-dynamic-controls-container">
        <!-- Panels will be injected here by JS or defined statically and shown/hidden -->
        <div id="quran-options-panel" class="control-panel active-panel">
          <h3>إعدادات القرآن</h3>
          <div><label>السورة:</label><select id="surah-select"></select></div>
          <div class="ayah-range-inputs">
            <div><label>من آية:</label><input type="number" id="ayah-start-input" value="1" min="1"></div>
            <div><label>إلى آية:</label><input type="number" id="ayah-end-input" value="7" min="1"></div>
          </div>
          <div><label>القارئ:</label><select id="reciter-select"></select></div>
          <div><label>الترجمة:</label><select id="translation-select"><option value="">بدون ترجمة</option></select></div>
        </div>

        <div id="text-style-options-panel" class="control-panel">
          <h3>إعدادات النص</h3>
          <div><label>خط القرآن:</label><select id="font-select">
            <option value="'Amiri Quran', serif">Amiri Quran</option>
            <option value="'Noto Naskh Arabic', serif">Noto Naskh Arabic</option>
            <option value="'Tajawal', sans-serif">Tajawal</option>
          </select></div>
          <div><label>حجم الخط:</label><input type="range" id="font-size-slider" min="20" max="100" value="48"> <span id="font-size-value">48px</span></div>
          <div><label>لون الخط:</label><input type="color" id="font-color-picker" value="#FFFFFF"></div>
          <div><label>خلفية الآية (لون):</label><input type="color" id="ayah-bg-color-picker" value="rgba(0,0,0,0.3)"></div>
          <div><label>تأثير النص:</label><select id="text-effect-select">
              <option value="none">بدون</option>
              <option value="fade">تلاشي</option>
              <option value="typewriter">كتابة</option>
          </select></div>
        </div>

        <div id="background-options-panel" class="control-panel">
          <h3>إعدادات الخلفية</h3>
          <div><label>استيراد خلفية (صورة/فيديو):</label><input type="file" id="import-background" accept="image/*,video/*"></div>
          <button id="apply-ai-bg" class="control-button">اقتراح خلفية (AI)</button>
          <div id="ai-bg-suggestions-loader" style="display:none;">جاري تحميل الاقتراحات...</div>
          <div id="ai-bg-suggestions"></div>
        </div>
        
        <div id="audio-options-panel" class="control-panel">
          <h3>إعدادات الصوت</h3>
           <div class="audio-preview-controls">
              <button id="play-pause-audio-preview-btn" class="control-button"><i class="fas fa-play-circle"></i> تشغيل معاينة الصوت</button>
              <button id="stop-audio-preview-btn" class="control-button" style="display:none;"><i class="fas fa-stop-circle"></i> إيقاف</button>
              <span id="audio-preview-status"></span>
           </div>
           <div><label>تأخير بين الآيات (ثواني - للعرض بدون صوت):</label><input type="number" id="delay-between-ayahs" value="1" min="0" step="0.5"></div>
        </div>

        <div id="export-options-panel" class="control-panel">
          <h3>إعدادات التصدير</h3>
          <div><label>دقة التصدير:</label><select id="resolution-select">
            <option value="1280x720">720p (1280x720)</option>
            <option value="1920x1080" selected>1080p (1920x1080)</option>
            <option value="3840x2160">4K (3840x2160)</option>
          </select></div>
          <div><label>تأثير انتقالي بين الآيات:</label><select id="transition-select">
            <option value="none">بدون</option>
            <option value="fade">تلاشي</option>
          </select></div>
          <button id="export-btn" class="main-button"><i class="fas fa-video"></i> تصدير الفيديو (حالياً بدون صوت)</button>
          <p style="font-size: 0.8em; opacity: 0.7;">ملاحظة: تصدير الصوت مع الفيديو قيد التطوير.</p>
          <div id="export-progress" style="display:none;">
              <progress id="export-progress-bar" value="0" max="100"></progress>
              <span id="export-progress-text">0%</span>
          </div>
        </div>
      </div>

      <footer id="editor-bottom-bar">
        <div id="timeline-placeholder">
          <!-- شريط زمني بسيط -->
          <div class="timeline-tick">0s</div>
          <div class="timeline-track"></div>
          <div class="timeline-tick">2s</div>
          <div class="timeline-track"></div>
          <div class="timeline-tick">4s</div>
        </div>
        <nav id="main-actions-toolbar">
          <button class="action-tool-btn active" data-panel="quran-options-panel" data-title="القرآن" title="القرآن"><i class="fas fa-book-quran"></i><span>القرآن</span></button>
          <button class="action-tool-btn" data-panel="text-style-options-panel" data-title="النص" title="النص"><i class="fas fa-font"></i><span>النص</span></button>
          <button class="action-tool-btn" data-panel="background-options-panel" data-title="الخلفية" title="الخلفية"><i class="fas fa-image"></i><span>الخلفية</span></button>
          <button class="action-tool-btn" data-panel="audio-options-panel" data-title="الصوت" title="الصوت"><i class="fas fa-volume-up"></i><span>الصوت</span></button> <!-- Changed icon for generic sound -->
          <button class="action-tool-btn" data-panel="export-options-panel" data-title="تصدير" title="تصدير"><i class="fas fa-share-square"></i><span>تصدير</span></button>
        </nav>
        <!-- The X and Checkmark buttons are now part of the top bar or handled by context -->
      </footer>
    </div>
  </div>

  <div id="loading-spinner" class="spinner-overlay" style="display:none;"><div class="spinner"></div></div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ccapture.js@1.1.0/build/CCapture.all.min.js"></script>
  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').then(registration => {
          console.log('SW registered: ', registration);
        }).catch(registrationError => {
          console.log('SW registration failed: ', registrationError);
        });
      });
    }
  </script>
</body>
</html>
